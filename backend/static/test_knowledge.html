<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŸ¥è¯†åº“åŠŸèƒ½æµ‹è¯• - å°é›ªå®AIåŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8 text-blue-600">çŸ¥è¯†åº“åŠŸèƒ½æµ‹è¯•</h1>
        
        <!-- çŸ¥è¯†åº“æœç´¢æµ‹è¯• -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">ğŸ“š å¢å¼ºç‰ˆçŸ¥è¯†åº“æœç´¢æµ‹è¯•</h2>
            <div class="space-y-4">
                <!-- åŸºç¡€æœç´¢ -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">æœç´¢å…³é”®è¯ï¼š</label>
                    <div class="flex space-x-2">
                        <input type="text" id="searchInput" class="flex-1 p-3 border border-gray-300 rounded-md"
                               placeholder="ä¾‹å¦‚ï¼šç™½è¡€ç—…ã€åŒ–ç–—ã€è¥å…»" onkeydown="handleSearchKeyDown(event)">
                        <button onclick="testKnowledgeSearch()" class="bg-blue-500 text-white px-6 py-3 rounded hover:bg-blue-600">
                            å¸¸è§„æœç´¢
                        </button>
                        <button onclick="testSmartSearch()" class="bg-purple-500 text-white px-6 py-3 rounded hover:bg-purple-600">
                            æ™ºèƒ½æœç´¢
                        </button>
                    </div>
                </div>

                <!-- é«˜çº§æœç´¢é€‰é¡¹ -->
                <div class="grid md:grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">åˆ†ç±»ç­›é€‰ï¼š</label>
                        <select id="categoryFilter" class="w-full p-2 border border-gray-300 rounded-md">
                            <option value="">å…¨éƒ¨åˆ†ç±»</option>
                            <option value="ç–¾ç—…çŸ¥è¯†">ç–¾ç—…çŸ¥è¯†</option>
                            <option value="æ²»ç–—æŠ¤ç†">æ²»ç–—æŠ¤ç†</option>
                            <option value="å¿ƒç†å¥åº·">å¿ƒç†å¥åº·</option>
                            <option value="è¥å…»æŒ‡å¯¼">è¥å…»æŒ‡å¯¼</option>
                            <option value="å®¶é•¿æ”¯æŒ">å®¶é•¿æ”¯æŒ</option>
                            <option value="ç”Ÿæ´»æŒ‡å¯¼">ç”Ÿæ´»æŒ‡å¯¼</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">æœ€ä½ç›¸å…³åº¦ï¼š</label>
                        <select id="minScoreFilter" class="w-full p-2 border border-gray-300 rounded-md">
                            <option value="0">ä¸é™åˆ¶</option>
                            <option value="1">1åˆ†ä»¥ä¸Š</option>
                            <option value="2">2åˆ†ä»¥ä¸Š</option>
                            <option value="3">3åˆ†ä»¥ä¸Š</option>
                        </select>
                    </div>
                </div>

                <!-- å¿«æ·æœç´¢æŒ‰é’® -->
                <div>
                    <p class="text-sm text-gray-600 mb-2">å¿«æ·æœç´¢ï¼š</p>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="quickSearch('ç™½è¡€ç—…')" class="text-sm bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded-full">ç™½è¡€ç—…</button>
                        <button onclick="quickSearch('åŒ–ç–—')" class="text-sm bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded-full">åŒ–ç–—</button>
                        <button onclick="quickSearch('è¥å…»')" class="text-sm bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded-full">è¥å…»</button>
                        <button onclick="quickSearch('å¿ƒç†')" class="text-sm bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded-full">å¿ƒç†</button>
                        <button onclick="quickSearch('ç—‡çŠ¶')" class="text-sm bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded-full">ç—‡çŠ¶</button>
                        <button onclick="quickSearch('å®¶é•¿')" class="text-sm bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded-full">å®¶é•¿</button>
                    </div>
                </div>

                <!-- åˆ†ç±»æµè§ˆ -->
                <div>
                    <p class="text-sm text-gray-600 mb-2">åˆ†ç±»æµè§ˆï¼š</p>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                        <button onclick="testCategorySearch('ç–¾ç—…çŸ¥è¯†')" class="text-sm bg-red-100 hover:bg-red-200 p-2 rounded text-left">ğŸ¥ ç–¾ç—…çŸ¥è¯†</button>
                        <button onclick="testCategorySearch('æ²»ç–—æŠ¤ç†')" class="text-sm bg-green-100 hover:bg-green-200 p-2 rounded text-left">ğŸ’Š æ²»ç–—æŠ¤ç†</button>
                        <button onclick="testCategorySearch('å¿ƒç†å¥åº·')" class="text-sm bg-blue-100 hover:bg-blue-200 p-2 rounded text-left">ğŸ§˜ å¿ƒç†å¥åº·</button>
                        <button onclick="testCategorySearch('è¥å…»æŒ‡å¯¼')" class="text-sm bg-yellow-100 hover:bg-yellow-200 p-2 rounded text-left">ğŸ è¥å…»æŒ‡å¯¼</button>
                        <button onclick="testCategorySearch('å®¶é•¿æ”¯æŒ')" class="text-sm bg-purple-100 hover:bg-purple-200 p-2 rounded text-left">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å®¶é•¿æ”¯æŒ</button>
                        <button onclick="testCategorySearch('ç”Ÿæ´»æŒ‡å¯¼')" class="text-sm bg-pink-100 hover:bg-pink-200 p-2 rounded text-left">ğŸ  ç”Ÿæ´»æŒ‡å¯¼</button>
                    </div>
                </div>

                <div id="searchResult" class="mt-4 hidden">
                    <h3 class="font-semibold mb-2">æœç´¢ç»“æœï¼š</h3>
                    <div id="searchResponse"></div>
                </div>
            </div>
        </div>

        <!-- AIé—®ç­”æµ‹è¯•ï¼ˆé›†æˆçŸ¥è¯†åº“ï¼‰ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">ğŸ¤– AIé—®ç­”æµ‹è¯•ï¼ˆçŸ¥è¯†åº“å¢å¼ºï¼‰</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">è¾“å…¥é—®é¢˜ï¼š</label>
                    <textarea id="questionInput" class="w-full p-3 border border-gray-300 rounded-md" rows="3" 
                              placeholder="ä¾‹å¦‚ï¼šæˆ‘çš„å­©å­ç¡®è¯Šç™½è¡€ç—…åå¾ˆç„¦è™‘ï¼Œæ€ä¹ˆåŠï¼Ÿ"></textarea>
                </div>
                
                <!-- æ¨èé—®é¢˜ -->
                <div>
                    <p class="text-sm text-gray-600 mb-2">æ¨èé—®é¢˜ï¼š</p>
                    <div class="grid md:grid-cols-2 gap-2">
                        <button onclick="askQuestion('ä»€ä¹ˆæ˜¯ç™½è¡€ç—…ï¼Ÿ')" class="text-left text-sm bg-green-100 hover:bg-green-200 p-2 rounded">ä»€ä¹ˆæ˜¯ç™½è¡€ç—…ï¼Ÿ</button>
                        <button onclick="askQuestion('ç™½è¡€ç—…æœ‰å“ªäº›ç—‡çŠ¶ï¼Ÿ')" class="text-left text-sm bg-green-100 hover:bg-green-200 p-2 rounded">ç™½è¡€ç—…æœ‰å“ªäº›ç—‡çŠ¶ï¼Ÿ</button>
                        <button onclick="askQuestion('åŒ–ç–—æœŸé—´éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ')" class="text-left text-sm bg-green-100 hover:bg-green-200 p-2 rounded">åŒ–ç–—æœŸé—´éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ</button>
                        <button onclick="askQuestion('å¦‚ä½•è¿›è¡Œå¿ƒç†æ”¯æŒï¼Ÿ')" class="text-left text-sm bg-green-100 hover:bg-green-200 p-2 rounded">å¦‚ä½•è¿›è¡Œå¿ƒç†æ”¯æŒï¼Ÿ</button>
                        <button onclick="askQuestion('æ‚£å„¿è¥å…»å¦‚ä½•ç®¡ç†ï¼Ÿ')" class="text-left text-sm bg-green-100 hover:bg-green-200 p-2 rounded">æ‚£å„¿è¥å…»å¦‚ä½•ç®¡ç†ï¼Ÿ</button>
                        <button onclick="askQuestion('å®¶é•¿å¦‚ä½•ç®¡ç†æƒ…ç»ªï¼Ÿ')" class="text-left text-sm bg-green-100 hover:bg-green-200 p-2 rounded">å®¶é•¿å¦‚ä½•ç®¡ç†æƒ…ç»ªï¼Ÿ</button>
                    </div>
                </div>
                
                <button onclick="testAIChat()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    è·å–AIå›ç­”
                </button>
                <div id="chatResult" class="mt-4 hidden">
                    <h3 class="font-semibold mb-2">AIå›ç­”ï¼š</h3>
                    <div id="chatResponse"></div>
                </div>
            </div>
        </div>

        <!-- çŸ¥è¯†åº“ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ“Š çŸ¥è¯†åº“ç»Ÿè®¡ä¿¡æ¯</h2>
            <button onclick="getKnowledgeStats()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 mb-4">
                è·å–ç»Ÿè®¡ä¿¡æ¯
            </button>
            <div id="statsResult" class="hidden">
                <div id="statsResponse"></div>
            </div>
        </div>
    </div>

    <script>
        // å¤„ç†æœç´¢é”®ç›˜äº‹ä»¶
        function handleSearchKeyDown(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                testKnowledgeSearch();
            }
        }

        // å¿«æ·æœç´¢
        function quickSearch(keyword) {
            document.getElementById('searchInput').value = keyword;
            testKnowledgeSearch();
        }

        // æµ‹è¯•çŸ¥è¯†åº“æœç´¢
        async function testKnowledgeSearch() {
            const input = document.getElementById('searchInput').value;
            const resultDiv = document.getElementById('searchResult');
            const responseDiv = document.getElementById('searchResponse');
            
            if (!input.trim()) {
                alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }
            
            try {
                responseDiv.innerHTML = 'æœç´¢ä¸­...';
                resultDiv.classList.remove('hidden');
                
                const response = await fetch(`/api/v1/knowledge/search?q=${encodeURIComponent(input)}&limit=5`);
                const result = await response.json();
                
                if (result.success && result.data.results.length > 0) {
                    let html = `
                        <div class="mb-4 p-3 bg-blue-50 rounded">
                            <p><strong>æœç´¢æŸ¥è¯¢ï¼š</strong> ${result.data.query}</p>
                            <p><strong>æ‰¾åˆ°ç»“æœï¼š</strong> ${result.data.total} æ¡</p>
                            <p><strong>æœç´¢æ—¶é—´ï¼š</strong> ${result.data.search_time || 0} ç§’</p>
                        </div>
                    `;
                    
                    result.data.results.forEach((item, index) => {
                        html += `
                            <div class="mb-4 p-4 border border-gray-200 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <h4 class="text-lg font-semibold text-gray-800">${item.title}</h4>
                                    <span class="text-sm bg-blue-500 text-white px-2 py-1 rounded">${item.category}</span>
                                </div>
                                <p class="text-gray-600 mb-2">${item.full_content || item.content}</p>
                                <div class="flex items-center justify-between text-sm text-gray-500">
                                    <span>ç›¸å…³åº¦: ${item.relevance_score}</span>
                                    <span>æ¥æº: ${item.source}</span>
                                </div>
                                ${item.keywords ? `<div class="mt-2"><strong>å…³é”®è¯:</strong> ${item.keywords.join(', ')}</div>` : ''}
                            </div>
                        `;
                    });
                    
                    responseDiv.innerHTML = html;
                } else {
                    responseDiv.innerHTML = '<p class="text-gray-500">æœªæ‰¾åˆ°ç›¸å…³ä¿¡æ¯</p>';
                }
            } catch (error) {
                responseDiv.innerHTML = `<p class="text-red-500">é”™è¯¯ï¼š${error.message}</p>`;
            }
        }

        // è®¾ç½®é—®é¢˜
        function askQuestion(question) {
            document.getElementById('questionInput').value = question;
        }

        // æµ‹è¯•AIèŠå¤©
        async function testAIChat() {
            const input = document.getElementById('questionInput').value;
            const resultDiv = document.getElementById('chatResult');
            const responseDiv = document.getElementById('chatResponse');
            
            if (!input.trim()) {
                alert('è¯·è¾“å…¥é—®é¢˜');
                return;
            }
            
            try {
                responseDiv.innerHTML = 'AIæ­£åœ¨æ€è€ƒä¸­...';
                resultDiv.classList.remove('hidden');
                
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: input,
                        context: 'çŸ¥è¯†åº“åŠŸèƒ½æµ‹è¯•'
                    })
                });
                
                const data = await response.json();
                
                responseDiv.innerHTML = `
                    <div class="space-y-3">
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <p><strong>é—®é¢˜ï¼š</strong> ${input}</p>
                        </div>
                        <div class="p-4 bg-blue-50 rounded-lg">
                            <p><strong>AIå›ç­”ï¼š</strong></p>
                            <p class="mt-2">${data.answer.replace(/\n/g, '<br>')}</p>
                        </div>
                        <div class="flex items-center justify-between text-sm text-gray-600">
                            <span><strong>æ¥æºï¼š</strong> ${data.source}</span>
                            <span><strong>ç½®ä¿¡åº¦ï¼š</strong> ${(data.confidence * 100).toFixed(1)}%</span>
                        </div>
                    </div>
                `;
            } catch (error) {
                responseDiv.innerHTML = `<p class="text-red-500">é”™è¯¯ï¼š${error.message}</p>`;
            }
        }

        // è·å–çŸ¥è¯†åº“ç»Ÿè®¡ä¿¡æ¯
        async function getKnowledgeStats() {
            const resultDiv = document.getElementById('statsResult');
            const responseDiv = document.getElementById('statsResponse');
            
            try {
                responseDiv.innerHTML = 'è·å–ä¸­...';
                resultDiv.classList.remove('hidden');
                
                const response = await fetch('/api/v1/knowledge/stats');
                const result = await response.json();
                
                if (result.success) {
                    const data = result.data;
                    let html = `
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="p-4 bg-purple-50 rounded-lg">
                                <h4 class="font-semibold mb-2">åŸºæœ¬ä¿¡æ¯</h4>
                                <p><strong>æ€»æ¡ç›®æ•°ï¼š</strong> ${data.total_items}</p>
                                <p><strong>çŠ¶æ€ï¼š</strong> ${data.status}</p>
                                <p><strong>æœ€åæ›´æ–°ï¼š</strong> ${new Date(data.last_updated).toLocaleString()}</p>
                            </div>
                            <div class="p-4 bg-purple-50 rounded-lg">
                                <h4 class="font-semibold mb-2">åˆ†ç±»ç»Ÿè®¡</h4>
                    `;
                    
                    for (const [category, count] of Object.entries(data.categories)) {
                        html += `<p><strong>${category}ï¼š</strong> ${count} æ¡</p>`;
                    }
                    
                    html += `
                            </div>
                        </div>
                    `;
                    
                    responseDiv.innerHTML = html;
                } else {
                    responseDiv.innerHTML = `<p class="text-red-500">${result.message}</p>`;
                }
            } catch (error) {
                responseDiv.innerHTML = `<p class="text-red-500">é”™è¯¯ï¼š${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
