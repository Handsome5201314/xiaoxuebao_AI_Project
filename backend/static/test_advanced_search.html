<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜çº§æœç´¢æµ‹è¯• - å°é›ªå®AIåŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <!-- é¡µé¢æ ‡é¢˜ -->
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">ğŸ” é«˜çº§çŸ¥è¯†åº“æœç´¢æµ‹è¯•</h1>
                <p class="text-gray-600">æµ‹è¯•å¢å¼ºç‰ˆçŸ¥è¯†åº“æœç´¢åŠŸèƒ½</p>
            </div>

            <!-- æœç´¢ç•Œé¢ -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-xl font-semibold mb-4">æœç´¢æµ‹è¯•</h2>
                
                <!-- åŸºç¡€æœç´¢ -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">æœç´¢å…³é”®è¯ï¼š</label>
                    <div class="flex space-x-2">
                        <input type="text" id="searchInput" class="flex-1 p-3 border border-gray-300 rounded-md" 
                               placeholder="ä¾‹å¦‚ï¼šç™½è¡€ç—…ã€åŒ–ç–—ã€è¥å…»" onkeydown="handleSearchKeyDown(event)">
                        <button onclick="testRegularSearch()" class="bg-blue-500 text-white px-6 py-3 rounded hover:bg-blue-600">
                            å¸¸è§„æœç´¢
                        </button>
                        <button onclick="testSmartSearch()" class="bg-purple-500 text-white px-6 py-3 rounded hover:bg-purple-600">
                            æ™ºèƒ½æœç´¢
                        </button>
                    </div>
                </div>

                <!-- é«˜çº§é€‰é¡¹ -->
                <div class="grid md:grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">åˆ†ç±»ç­›é€‰ï¼š</label>
                        <select id="categoryFilter" class="w-full p-2 border border-gray-300 rounded-md">
                            <option value="">å…¨éƒ¨åˆ†ç±»</option>
                            <option value="ç–¾ç—…çŸ¥è¯†">ç–¾ç—…çŸ¥è¯†</option>
                            <option value="æ²»ç–—æŠ¤ç†">æ²»ç–—æŠ¤ç†</option>
                            <option value="å¿ƒç†å¥åº·">å¿ƒç†å¥åº·</option>
                            <option value="è¥å…»æŒ‡å¯¼">è¥å…»æŒ‡å¯¼</option>
                            <option value="å®¶é•¿æ”¯æŒ">å®¶é•¿æ”¯æŒ</option>
                            <option value="ç”Ÿæ´»æŒ‡å¯¼">ç”Ÿæ´»æŒ‡å¯¼</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">æœ€ä½ç›¸å…³åº¦ï¼š</label>
                        <select id="minScoreFilter" class="w-full p-2 border border-gray-300 rounded-md">
                            <option value="0">ä¸é™åˆ¶</option>
                            <option value="1">1åˆ†ä»¥ä¸Š</option>
                            <option value="2">2åˆ†ä»¥ä¸Š</option>
                            <option value="3">3åˆ†ä»¥ä¸Š</option>
                        </select>
                    </div>
                </div>

                <!-- å¿«æ·æœç´¢ -->
                <div class="mb-4">
                    <p class="text-sm text-gray-600 mb-2">å¿«æ·æœç´¢ï¼š</p>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="quickSearch('ç™½è¡€ç—…')" class="text-sm bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded-full">ç™½è¡€ç—…</button>
                        <button onclick="quickSearch('åŒ–ç–—')" class="text-sm bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded-full">åŒ–ç–—</button>
                        <button onclick="quickSearch('è¥å…»')" class="text-sm bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded-full">è¥å…»</button>
                        <button onclick="quickSearch('å¿ƒç†')" class="text-sm bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded-full">å¿ƒç†</button>
                        <button onclick="quickSearch('ç—‡çŠ¶')" class="text-sm bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded-full">ç—‡çŠ¶</button>
                        <button onclick="quickSearch('å®¶é•¿')" class="text-sm bg-blue-100 hover:bg-blue-200 px-3 py-1 rounded-full">å®¶é•¿</button>
                    </div>
                </div>

                <!-- åˆ†ç±»æµè§ˆ -->
                <div>
                    <p class="text-sm text-gray-600 mb-2">åˆ†ç±»æµè§ˆï¼š</p>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                        <button onclick="testCategorySearch('ç–¾ç—…çŸ¥è¯†')" class="text-sm bg-red-100 hover:bg-red-200 p-2 rounded text-left">ğŸ¥ ç–¾ç—…çŸ¥è¯†</button>
                        <button onclick="testCategorySearch('æ²»ç–—æŠ¤ç†')" class="text-sm bg-green-100 hover:bg-green-200 p-2 rounded text-left">ğŸ’Š æ²»ç–—æŠ¤ç†</button>
                        <button onclick="testCategorySearch('å¿ƒç†å¥åº·')" class="text-sm bg-blue-100 hover:bg-blue-200 p-2 rounded text-left">ğŸ§˜ å¿ƒç†å¥åº·</button>
                        <button onclick="testCategorySearch('è¥å…»æŒ‡å¯¼')" class="text-sm bg-yellow-100 hover:bg-yellow-200 p-2 rounded text-left">ğŸ è¥å…»æŒ‡å¯¼</button>
                        <button onclick="testCategorySearch('å®¶é•¿æ”¯æŒ')" class="text-sm bg-purple-100 hover:bg-purple-200 p-2 rounded text-left">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å®¶é•¿æ”¯æŒ</button>
                        <button onclick="testCategorySearch('ç”Ÿæ´»æŒ‡å¯¼')" class="text-sm bg-pink-100 hover:bg-pink-200 p-2 rounded text-left">ğŸ  ç”Ÿæ´»æŒ‡å¯¼</button>
                    </div>
                </div>
            </div>

            <!-- æœç´¢ç»“æœ -->
            <div id="searchResult" class="hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-4">æœç´¢ç»“æœ</h3>
                    <div id="searchResponse"></div>
                </div>
            </div>

            <!-- APIæµ‹è¯• -->
            <div class="bg-white rounded-lg shadow-md p-6 mt-8">
                <h2 class="text-xl font-semibold mb-4">APIæµ‹è¯•</h2>
                <div class="grid md:grid-cols-2 gap-4">
                    <button onclick="testGetCategories()" class="bg-green-500 text-white p-3 rounded hover:bg-green-600">
                        è·å–æ‰€æœ‰åˆ†ç±»
                    </button>
                    <button onclick="testGetKeywords()" class="bg-yellow-500 text-white p-3 rounded hover:bg-yellow-600">
                        è·å–çƒ­é—¨å…³é”®è¯
                    </button>
                </div>
                <div id="apiResult" class="mt-4 hidden">
                    <h4 class="font-semibold mb-2">APIå“åº”ï¼š</h4>
                    <div id="apiResponse" class="bg-gray-50 p-4 rounded border"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å¤„ç†å›è½¦é”®æœç´¢
        function handleSearchKeyDown(event) {
            if (event.key === 'Enter') {
                testRegularSearch();
            }
        }

        // å¿«æ·æœç´¢
        function quickSearch(query) {
            document.getElementById('searchInput').value = query;
            testSmartSearch();
        }

        // å¸¸è§„æœç´¢æµ‹è¯•
        async function testRegularSearch() {
            const input = document.getElementById('searchInput');
            const resultDiv = document.getElementById('searchResult');
            const responseDiv = document.getElementById('searchResponse');
            const categoryFilter = document.getElementById('categoryFilter');
            const minScoreFilter = document.getElementById('minScoreFilter');
            const query = input.value.trim();

            if (!query) {
                alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }

            try {
                responseDiv.innerHTML = '<div class="text-blue-500">å¸¸è§„æœç´¢ä¸­...</div>';
                resultDiv.classList.remove('hidden');

                // æ„å»ºæœç´¢URL
                let searchUrl = `/api/v1/knowledge/search?q=${encodeURIComponent(query)}&limit=5`;
                if (categoryFilter.value) {
                    searchUrl += `&category=${encodeURIComponent(categoryFilter.value)}`;
                }
                if (minScoreFilter.value) {
                    searchUrl += `&min_score=${minScoreFilter.value}`;
                }

                const response = await fetch(searchUrl);
                const result = await response.json();

                displaySearchResults(result, 'ğŸ” å¸¸è§„æœç´¢ç»“æœ', 'blue');

            } catch (error) {
                console.error('æœç´¢å¤±è´¥:', error);
                responseDiv.innerHTML = `<div class="text-red-500 p-4 bg-red-50 rounded">æœç´¢å¤±è´¥ï¼š${error.message}</div>`;
            }
        }

        // æ™ºèƒ½æœç´¢æµ‹è¯•
        async function testSmartSearch() {
            const input = document.getElementById('searchInput');
            const resultDiv = document.getElementById('searchResult');
            const responseDiv = document.getElementById('searchResponse');
            const query = input.value.trim();

            if (!query) {
                alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }

            try {
                responseDiv.innerHTML = '<div class="text-purple-500">æ™ºèƒ½æœç´¢ä¸­...</div>';
                resultDiv.classList.remove('hidden');

                const response = await fetch(`/api/v1/knowledge/smart-search?q=${encodeURIComponent(query)}&limit=5`);
                const result = await response.json();

                displaySmartSearchResults(result);

            } catch (error) {
                console.error('æ™ºèƒ½æœç´¢å¤±è´¥:', error);
                responseDiv.innerHTML = `<div class="text-red-500 p-4 bg-red-50 rounded">æ™ºèƒ½æœç´¢å¤±è´¥ï¼š${error.message}</div>`;
            }
        }

        // åˆ†ç±»æœç´¢æµ‹è¯•
        async function testCategorySearch(category) {
            const resultDiv = document.getElementById('searchResult');
            const responseDiv = document.getElementById('searchResponse');

            try {
                responseDiv.innerHTML = `<div class="text-green-500">åŠ è½½åˆ†ç±» "${category}" ä¸­...</div>`;
                resultDiv.classList.remove('hidden');

                const response = await fetch(`/api/v1/knowledge/category/${encodeURIComponent(category)}`);
                const result = await response.json();

                displayCategoryResults(result, category);

            } catch (error) {
                console.error('åˆ†ç±»æœç´¢å¤±è´¥:', error);
                responseDiv.innerHTML = `<div class="text-red-500 p-4 bg-red-50 rounded">åˆ†ç±»æœç´¢å¤±è´¥ï¼š${error.message}</div>`;
            }
        }

        // æ˜¾ç¤ºæœç´¢ç»“æœ
        function displaySearchResults(result, title, color) {
            const responseDiv = document.getElementById('searchResponse');
            
            let html = `
                <div class="bg-${color}-50 p-4 rounded-lg mb-4">
                    <h4 class="font-semibold mb-2 text-${color}-800">${title}</h4>
                    <div class="text-sm text-${color}-600">
                        æŸ¥è¯¢è¯ï¼š${result.data.query} | 
                        ç»“æœæ•°ï¼š${result.data.total} | 
                        æœç´¢æ—¶é—´ï¼š${result.data.search_time}ç§’
                    </div>
                </div>
            `;

            if (result.success && result.data.results.length > 0) {
                html += '<div class="space-y-3">';

                result.data.results.forEach((item, index) => {
                    html += `
                        <div class="border border-${color}-200 rounded-lg p-4 hover:border-${color}-400 transition-colors bg-white">
                            <div class="flex items-center justify-between mb-2">
                                <h5 class="font-medium text-lg text-gray-800">${item.title}</h5>
                                <span class="text-xs bg-${color}-500 text-white px-2 py-1 rounded">${item.category}</span>
                            </div>
                            <p class="text-gray-600 text-sm mb-2">${item.content}</p>
                            <div class="flex items-center justify-between text-xs text-gray-500">
                                <span class="font-medium">ç›¸å…³åº¦ï¼š${item.relevance_score}</span>
                                <span>å…³é”®è¯ï¼š${item.keywords.join(', ')}</span>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
            } else {
                html += '<div class="text-gray-500 p-4 bg-gray-50 rounded">æœªæ‰¾åˆ°ç›¸å…³ç»“æœ</div>';
            }

            responseDiv.innerHTML = html;
        }

        // æ˜¾ç¤ºæ™ºèƒ½æœç´¢ç»“æœ
        function displaySmartSearchResults(result) {
            const responseDiv = document.getElementById('searchResponse');
            
            let html = `
                <div class="bg-purple-50 p-4 rounded-lg mb-4">
                    <h4 class="font-semibold mb-2 text-purple-800">ğŸ§  æ™ºèƒ½æœç´¢ç»“æœ</h4>
                    <div class="text-sm text-purple-600">
                        æŸ¥è¯¢è¯ï¼š${result.data.query} | 
                        ç»“æœæ•°ï¼š${result.data.total_results} | 
                        æœç´¢æ—¶é—´ï¼š${result.data.search_time}ç§’
                    </div>
                </div>
            `;

            if (result.success && result.data.results.length > 0) {
                // æœç´¢ç»“æœ
                html += '<div class="space-y-3 mb-4">';
                result.data.results.forEach((item, index) => {
                    html += `
                        <div class="border border-purple-200 rounded-lg p-4 hover:border-purple-400 transition-colors bg-white">
                            <div class="flex items-center justify-between mb-2">
                                <h5 class="font-medium text-lg text-gray-800">${item.title}</h5>
                                <span class="text-xs bg-purple-500 text-white px-2 py-1 rounded">${item.category}</span>
                            </div>
                            <p class="text-gray-600 text-sm mb-2">${item.content}</p>
                            <div class="flex items-center justify-between text-xs text-gray-500">
                                <span class="font-medium">æ™ºèƒ½è¯„åˆ†ï¼š${item.relevance_score}</span>
                                <span>å…³é”®è¯ï¼š${item.keywords.join(', ')}</span>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';

                // æœç´¢å»ºè®®
                if (result.data.suggestions && result.data.suggestions.length > 0) {
                    html += `
                        <div class="bg-yellow-50 p-4 rounded-lg mb-4">
                            <h5 class="font-medium mb-2 text-yellow-800">ğŸ’¡ æœç´¢å»ºè®®</h5>
                            <div class="flex flex-wrap gap-2">
                    `;
                    result.data.suggestions.forEach(suggestion => {
                        html += `<button onclick="document.getElementById('searchInput').value='${suggestion}'; testSmartSearch();" class="text-sm bg-yellow-100 hover:bg-yellow-200 px-3 py-1 rounded-full border border-yellow-300">${suggestion}</button>`;
                    });
                    html += '</div></div>';
                }

                // ç›¸å…³åˆ†ç±»
                if (result.data.related_categories && result.data.related_categories.length > 0) {
                    html += `
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h5 class="font-medium mb-2 text-green-800">ğŸ“‚ ç›¸å…³åˆ†ç±»</h5>
                            <div class="flex flex-wrap gap-2">
                    `;
                    result.data.related_categories.forEach(cat => {
                        html += `<button onclick="testCategorySearch('${cat.category}')" class="text-sm bg-green-100 hover:bg-green-200 px-3 py-1 rounded-full border border-green-300">${cat.category} (${cat.item_count}æ¡)</button>`;
                    });
                    html += '</div></div>';
                }

            } else {
                html += '<div class="text-gray-500 p-4 bg-gray-50 rounded">æœªæ‰¾åˆ°ç›¸å…³ç»“æœ</div>';
            }

            responseDiv.innerHTML = html;
        }

        // æ˜¾ç¤ºåˆ†ç±»ç»“æœ
        function displayCategoryResults(result, category) {
            const responseDiv = document.getElementById('searchResponse');
            
            let html = `
                <div class="bg-green-50 p-4 rounded-lg mb-4">
                    <h4 class="font-semibold mb-2 text-green-800">ğŸ“ åˆ†ç±»æµè§ˆï¼š${category}</h4>
                    <div class="text-sm text-green-600">
                        åˆ†ç±»ï¼š${result.data.category} | 
                        å†…å®¹æ•°ï¼š${result.data.total} | 
                        æœç´¢æ—¶é—´ï¼š${result.data.search_time}ç§’
                    </div>
                </div>
            `;

            if (result.success && result.data.results.length > 0) {
                html += '<div class="space-y-3">';

                result.data.results.forEach((item, index) => {
                    html += `
                        <div class="border border-green-200 rounded-lg p-4 hover:border-green-400 transition-colors bg-white">
                            <div class="flex items-center justify-between mb-2">
                                <h5 class="font-medium text-lg text-gray-800">${item.title}</h5>
                                <span class="text-xs bg-green-500 text-white px-2 py-1 rounded">${item.category}</span>
                            </div>
                            <p class="text-gray-600 text-sm mb-2">${item.content}</p>
                            <div class="text-xs text-gray-500">
                                <span>å…³é”®è¯ï¼š${item.keywords.join(', ')}</span>
                            </div>
                        </div>
                    `;
                });

                html += '</div>';
            } else {
                html += '<div class="text-gray-500 p-4 bg-gray-50 rounded">è¯¥åˆ†ç±»ä¸‹æš‚æ— å†…å®¹</div>';
            }

            responseDiv.innerHTML = html;
        }

        // æµ‹è¯•è·å–åˆ†ç±»
        async function testGetCategories() {
            const resultDiv = document.getElementById('apiResult');
            const responseDiv = document.getElementById('apiResponse');

            try {
                responseDiv.innerHTML = 'è·å–åˆ†ç±»ä¸­...';
                resultDiv.classList.remove('hidden');

                const response = await fetch('/api/v1/knowledge/categories');
                const result = await response.json();

                responseDiv.innerHTML = `<pre class="text-sm overflow-x-auto">${JSON.stringify(result, null, 2)}</pre>`;

            } catch (error) {
                responseDiv.innerHTML = `<div class="text-red-500">è·å–åˆ†ç±»å¤±è´¥ï¼š${error.message}</div>`;
            }
        }

        // æµ‹è¯•è·å–å…³é”®è¯
        async function testGetKeywords() {
            const resultDiv = document.getElementById('apiResult');
            const responseDiv = document.getElementById('apiResponse');

            try {
                responseDiv.innerHTML = 'è·å–å…³é”®è¯ä¸­...';
                resultDiv.classList.remove('hidden');

                const response = await fetch('/api/v1/knowledge/keywords?limit=10');
                const result = await response.json();

                responseDiv.innerHTML = `<pre class="text-sm overflow-x-auto">${JSON.stringify(result, null, 2)}</pre>`;

            } catch (error) {
                responseDiv.innerHTML = `<div class="text-red-500">è·å–å…³é”®è¯å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
